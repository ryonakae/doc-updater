{
  "hooks": {
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "以下のJSONを確認してください。\n\n$ARGUMENTS\n\n【ルール】\n1. stop_hook_activeがtrueの場合: 必ず{\"ok\": true}を返してください（ループ防止）\n2. stop_hook_activeがfalseの場合のみ、last_assistant_messageを判定してください\n\n【判定基準】last_assistant_messageが、プロジェクト構成に影響する作業の完了報告かどうか。\n対象: コードファイル（.ts .tsx .js .jsx .py .swift .kt 等）の実装・修正・リファクタリング、依存関係ファイルの変更（package.json requirements.txt 等）、ファイルのリネームや削除、ビルド・スクリプトの変更（Makefile justfile 等）、開発環境設定の変更（docker-compose.yml tsconfig.json .env.example 等）\n非対象: 質問への回答、計画・設計の提示、調査報告、ドキュメントのみの変更、テストのみの実行、会話的なやり取り\n\n【応答】JSONのみで返してください:\n- 実装完了報告の場合: {\"ok\": false, \"reason\": \"実装完了を検出しました。停止前に以下を順番に実行してください。\\n\\n1. セッション振り返り: このセッション中に失敗・修正・試行錯誤があった場合、以下を .claude/reflections.md に書き出してください。なければスキップ。\\n   - 失敗パターン: エージェントが間違えた箇所、人間に修正された箇所\\n   - 根本原因: なぜ間違えたか\\n   - 防止策: エージェント指示ファイルに追記すべきルール（事実形式で記述）\\n\\n2. doc-updater 呼び出し: doc-updater サブエージェント（モデルは必ず haiku）に以下を依頼してください。run_in_background は使わず、完了を待ってください。\\n   『git diff HEAD で変更内容を確認し、必要に応じてドキュメントを更新してください。.claude/reflections.md が存在する場合は防止策をエージェント指示ファイルに反映し、反映後に削除してください。』\\n\\n3. doc-updater の完了を確認してから停止してください。\"}\n- それ以外: {\"ok\": true}"
          }
        ]
      }
    ]
  }
}
